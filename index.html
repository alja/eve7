<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Eve7</title>
      <script type="text/javascript" src="jsrootsys/scripts/JSRootCore.js"></script>
   </head>
    
   <style>
      html { height: 100%; }
      body { min-height: 100%; margin: 0; overflow: hidden }
      #EveDiv {
         position: absolute;
         left: 0;
         top: 0;
         bottom: 0;
         right: 0;
         padding: 1
      }
   </style>

   <body>
      <div id="EveDiv">
         loading scripts...
      </div>
   </body>

 <script type='text/javascript'>

var globalHandle;
function InitCustomUI(handle) {
    // from here you can use  JSROOT.sap variable like

    sap.ui.getCore().loadLibrary("sap.tnt"); 
    jQuery.sap.registerModulePath("mysplit", "/currentdir/");

    
    handle.SetReceiver({
	OnWebsocketOpened: function(handle) {
	    console.log('Connected');
            globalHandle = handle;
	},
	
	OnWebsocketMsg: function(handle, msg) {
	    console.log('>>> index.html OnWebsocketMsg  Get msg ' + msg.substring(0, 30) + ' handle ' + !!handle);
	    //  var controllerName;
	    var funcName;
	    var funcArgs;
	    for (var i = 0; i < msg.length; i++) {
		//	 console.log(i, "----- check ",msg[i] );
		if (msg[i] == '_') {
		    //  controllerName =  msg.substring(0, i);
		}
		if (msg[i] == ':') {
		  //  var elem = sap.ui.core.byId("MainPanel");
		    var elem = sap.ui.getCore().byId("TopEveId--MainPanel");
		    console.log("elem 2, ", elem);
		    var cont = elem.getController();
		    console.log("cont ", cont);
                    cont["ProcessMsg"](msg);
		    //  cont[funcName](funcArgs);
		    // console.log(" funcName =  ", msg.substring(controllerName.length + 1, i));
		    break;
		}
	    }
	},
	
	OnWebsocketClosed: function(handle) {
	    // when connection closed, close panel as well
	    if (window) window.close();
	}
    });
    
    handle.Connect(); // only here connection is established
    
      
     return JSROOT.AssertPrerequisites('openui5', function() {
     
     
     new JSROOT.sap.ui.xmlview({
     id: "TopEveId",
     viewName: "mysplit.Main"
     }).placeAt("EveDiv");
     });

}

JSROOT.ConnectWebWindow({
    prereq: "openui5;",
    prereq_logdiv: "EveDiv",
    callback: InitCustomUI
});

</script>
</html>
